local httpService = game:GetService('HttpService')
local httprequest = (http and http.request or http_request or fluxus and fluxus.request or request or function() end)
local isfile = isfile or function(file)
    local success, filecontents = pcall(function() return readfile(file) end)
    return success and type(filecontents) == 'string'
end 

function Reset()
    if isfolder('vape') then
        delfolder('vape')
    end
end

function Makevapefolders()
    if not isfolder('vape/assets') then 
        makefolder('vape/assets')
    end
    if not isfolder('vape/CustomModules') then 
        makefolder('vape/CustomModules')
    end
    if not isfolder('vape/Libraries') then 
        makefolder('vape/Libraries')
    end
    if not isfolder('vape/Profiles') then 
        makefolder('vape/Profiles')
    end
    if not isfile('vape/PurpleVerison.txt') then 
        writefile('vape/PurpleVerison.txt', "1.7")
    end
end

function BatchedWriteFiles(folder, files)
    for _, file in ipairs(files) do
        local body = httprequest({Url = file.url, Method = 'GET'}).Body
        local filePath = folder .. "/" .. file.name
        writefile(filePath, body)
    end
end

function InstallModules()
    local modules = {
        {name = "6872274481.lua", url = "https://raw.githubusercontent.com/e266cfd65ad46a67fc54b0efd38e40dd/Installer/main/Modules/6872274481.lua"},
        {name = "cachechecked.txt", url = "https://raw.githubusercontent.com/e266cfd65ad46a67fc54b0efd38e40dd/Installer/main/Modules/cachechecked.txt"},
        {name = "6872265039.lua", url = "https://raw.githubusercontent.com/e266cfd65ad46a67fc54b0efd38e40dd/Installer/main/Modules/6872265039.lua"}
    }
    
    BatchedWriteFiles("vape/CustomModules", modules)
end

function InstallLibraries()
    local libraries = {
        {name = "entityHandler.lua", url = "https://raw.githubusercontent.com/e266cfd65ad46a67fc54b0efd38e40dd/Installer/main/Libraries/entityHandler.lua"},
        {name = "sha.lua", url = "https://raw.githubusercontent.com/e266cfd65ad46a67fc54b0efd38e40dd/Installer/main/Libraries/sha.lua"}
    }
    
    BatchedWriteFiles("vape/Libraries", libraries)
end

function InstallProfiles()
    local DCM = (game:GetService("UserInputService").TouchEnabled)
    local DCP = (game:GetService("UserInputService").KeyboardEnabled)
    
    if DCM then
        DCU = "https://raw.githubusercontent.com/e266cfd65ad46a67fc54b0efd38e40dd/Installer/main/Mobile-profiles/2619619496GUIPositions.vapeprofile.txt"
    elseif DCP then
        DCU = "https://raw.githubusercontent.com/e266cfd65ad46a67fc54b0efd38e40dd/Installer/main/Profiles/2619619496GUIPositions.vapeprofile.txt"
    end
    
    local profiles = {
        {name = "2619619496GUIPositions.vapeprofile.txt", url = DCU},
        {name = "6872265039.vapeprofile.txt", url = "https://raw.githubusercontent.com/e266cfd65ad46a67fc54b0efd38e40dd/Installer/main/Profiles/6872265039.vapeprofile.txt"},
        {name = "6872265039.vapeprofiles.txt", url = "https://raw.githubusercontent.com/e266cfd65ad46a67fc54b0efd38e40dd/Installer/main/Profiles/6872265039.vapeprofiles.txt"},
        {name = "6872274481.vapeprofile.txt", url = "https://raw.githubusercontent.com/e266cfd65ad46a67fc54b0efd38e40dd/Installer/main/Profiles/6872274481.vapeprofile.txt"},
        {name = "6872274481.vapeprofiles.txt", url = "https://raw.githubusercontent.com/e266cfd65ad46a67fc54b0efd38e40dd/Installer/main/Profiles/6872274481.vapeprofiles.txt"},
        {name = "bedwarsdata.txt", url = "https://raw.githubusercontent.com/e266cfd65ad46a67fc54b0efd38e40dd/Installer/main/Profiles/bedwarsdata.txt"}
    }
    
    BatchedWriteFiles("vape/Profiles", profiles)
end

function InstallOther()
    local other = {
          {name = "GuiLibrary.lua", url = "https://raw.githubusercontent.com/e266cfd65ad46a67fc54b0efd38e40dd/Installer/main/GuiLibrary.lua"},
          {name = "MainScript.lua", url = "https://raw.githubusercontent.com/e266cfd65ad46a67fc54b0efd38e40dd/Installer/main/MainScript.lua"},
          {name = "NewMainScript.lua", url = "https://raw.githubusercontent.com/e266cfd65ad46a67fc54b0efd38e40dd/Installer/main/NewMainScript.lua"},
          {name = "Universal.lua", url = "https://raw.githubusercontent.com/e266cfd65ad46a67fc54b0efd38e40dd/Installer/main/Universal.lua"},
          {name = "assetsversion.txt", url = "https://raw.githubusercontent.com/e266cfd65ad46a67fc54b0efd38e40dd/Installer/main/assetsversion.txt"}
    }
    
    BatchedWriteFiles("vape", other)
end

Reset()
Makevapefolders()
InstallModules()
InstallLibraries()
InstallProfiles()
InstallOther()

wait(0.5)

local UserInputService = game:GetService("UserInputService")
local DCM = UserInputService.TouchEnabled
local DCP = UserInputService.KeyboardEnabled

local DCU = nil

if DCM then
    DCU = loadstring(game:HttpGet("https://raw.githubusercontent.com/7GrandDadPGN/VapeV4ForRoblox/main/NewMainScript.lua", true))
elseif DCP then
    DCU = loadfile('vape/NewMainScript.lua')
end

DCU()
